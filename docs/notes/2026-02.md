# 2026년 2월 작업 로그

## 2026-02-12

### 팝업 윈도우 화면 깜빡임/잘못된 위치 이동 수정

- **작업 내용**: 팝업 윈도우가 화면 가운데에 잠깐 표시된 후 작업 표시줄 아래로 이동하는 문제 수정
- **근본 원인**:
  1. CleanupWindowResources에서 윈도우 크기를 screenWidth*2, screenHeight*2로 설정한 상태에서 Program.cs가 ShowWindow+PositionWindowAboveTaskbar 호출 → 거대한 윈도우가 화면 전체를 덮음 (화면 가운데 플래시)
  2. DispatcherQueue에서 실행되는 InitializeWindow가 Program.LaunchCursorPosition 사용 → 팝업 프로세스의 최초 실행 시 커서 위치(오래된 값)로 재배치
- **해결 방법**:
  - Program.cs: ShowWindow/ForceForegroundWindow/PositionWindowAboveTaskbar 제거, AllowSetForegroundWindow로 포그라운드 권한만 부여
  - PopupWindow SubclassProc: LoadConfiguration 완료 후 자체적으로 ShowWindow+ForceForegroundWindow 호출
  - InitializeWindow: 파일 기반 커서 위치 읽기 (AppPaths.ReadCursorPosition)
  - App.xaml.cs BringWindowToFront: 불필요한 ShowWindow/Position 제거, SendString만 전송
  - ShowPopupWindow: 불필요한 200ms 대기 제거
- **변경 파일**:
  - `AppPaths.cs` - SaveCursorPosition/ReadCursorPosition 메서드 추가
  - `Program.cs` - 커서 위치 파일 저장, 팝업 표시/위치 코드 제거
  - `View/PopupWindow.xaml.cs` - SubclassProc에 표시 로직 추가, InitializeWindow 파일 기반 커서 위치
  - `App.xaml.cs` - BringWindowToFront/ShowPopupWindow 단순화
- **검증 결과**: 빌드 성공
- **README.md 갱신**: 해당 없음 (내부 위치 배치 로직 버그 수정)

### 팝업 윈도우 위치를 작업 표시줄 아이콘 클릭 위치 기준으로 변경

- **작업 내용**: 팝업 윈도우가 마우스 현재 위치가 아닌 작업 표시줄 아이콘 클릭 위치 기준으로 표시되도록 변경
- **변경 파일**:
  - `Program.cs` - Main() 진입 즉시 GetCursorPos로 클릭 위치 캡처, 정적 프로퍼티에 저장
  - `NativeMethods.WindowPosition.cs` - PositionWindowAboveTaskbar에 POINT? capturedCursorPos 파라미터 추가
  - `App.xaml.cs` - BringWindowToFront에서 캡처된 커서 위치 전달
  - `View/PopupWindow.xaml.cs` - InitializeWindow에서 캡처된 커서 위치 전달
- **변경 이유**: 작업 표시줄 아이콘 클릭 후 마우스가 이동하면 팝업이 아이콘과 다른 위치에 표시되던 문제 해결
- **검증 결과**: 빌드 성공
- **README.md 갱신**: 해당 없음 (기능/동작 변경이 아닌 위치 배치 개선)

### 테마 기능 코드 리뷰 버그 수정

- **작업 내용**: 테마 변경 기능 코드 리뷰 후 발견된 버그 3건 + 성능 문제 1건 수정
- **변경 파일**:
  - `View/PopupWindow.xaml.cs` - Accent Color 로직 수정 (잘못된 테마 참조 + 동일 값 반환 버그)
  - `View/MainWindow.xaml.cs` - EditStartMenuDialog/FolderIconDialog ShowAsync 전 테마 적용 6곳 추가
  - `SettingsHelper.cs` - GetSavedTheme() 캐시 우선 사용으로 불필요한 파일 I/O 제거
- **수정 상세**:
  1. PopupWindow 290-292행: `Application.Current.RequestedTheme`(시스템 기본값) 대신 `savedTheme`(사용자 설정) 참조로 변경, Light/Dark 분기가 모두 `SystemAccentColorDark2`를 반환하던 것을 Dark 모드일 때 `SystemAccentColorDark3`으로 수정
  2. MainWindow: EditStartMenuDialog.ShowAsync() 5곳, FolderIconDialog.ShowAsync() 1곳에 `RequestedTheme = GetCurrentTheme()` 추가
  3. SettingsHelper.GetSavedTheme(): `_currentSettings` 캐시가 있으면 파일 읽기 없이 즉시 반환
- **검증 결과**: 빌드 성공 (오류 0개, 경고 762개 - 기존 nullable 관련)
- **README.md 갱신**: 해당 없음 (기능/동작/설정 변경 없음, 버그 수정만)

### 언어 변경 기능 추가

**작업 일자**: 2026-02-12

**수행한 작업 요약**
- 설정 화면에 언어 변경 UI 추가 (About 섹션 위)
- 지원 언어: 시스템 기본값, English (en-US), 한국어 (ko-KR)
- 기본값은 OS 언어이며 사용자가 언어를 선택하면 settings.json에 저장
- 앱 시작 시 `Windows.Globalization.ApplicationLanguages.PrimaryLanguageOverride`를 통해 저장된 언어 적용
- 언어 변경 후 재시작 안내 메시지 표시

**변경된 파일**
- `SettingsHelper.cs` - `AppSettings.Language` 속성 추가, `ApplyLanguageOverride()` 정적 메서드 추가
- `App.xaml.cs` - 생성자에서 `InitializeComponent()` 이전에 `ApplyLanguageOverride()` 호출
- `View/MainWindow.xaml` - 설정 화면 About 섹션 위에 언어 ComboBox UI 추가
- `View/MainWindow.xaml.cs` - `InitializeLanguageComboBox()`, `SettingsLanguageComboBox_SelectionChanged` 핸들러 추가
- `ViewModels/SettingsDialogViewModel.cs` - `SelectedLanguage` 속성 추가, Load/Save 메서드에 언어 설정 반영
- `Strings/en-US/Resources.resw` - LanguageSetting, LanguageSettingDescription, LanguageSystemDefault, LanguageRestartRequired 추가
- `Strings/ko-KR/Resources.resw` - 동일한 리소스 키의 한국어 번역 추가

**검증 결과**
- 빌드: 성공
- 테스트: N/A (UI 기능)
- 린트: N/A

**제한 사항**
- 언어 변경은 앱 재시작 후 적용됨 (WinUI 3 리소스 로더 한계)

---

### 일본어/중국어 리소스 파일 추가

**작업 일자**: 2026-02-12

**수행한 작업 요약**
- ja-JP (일본어), zh-CN (중국어 간체), zh-TW (중국어 번체) 리소스 파일 생성
- 기존 en-US/ko-KR 리소스의 모든 키를 번역하여 포함
- InitializeLanguageComboBox의 언어 선택 목록에 3개 언어 추가

**변경된 파일**
- `Strings/ja-JP/Resources.resw` (신규) - 일본어 번역 리소스
- `Strings/zh-CN/Resources.resw` (신규) - 중국어 간체 번역 리소스
- `Strings/zh-TW/Resources.resw` (신규) - 중국어 번체 번역 리소스
- `View/MainWindow.xaml.cs` - 언어 목록에 ja-JP, zh-CN, zh-TW 추가

**검증 결과**
- 빌드: 성공
- 테스트: N/A (리소스 파일 추가)
- 린트: N/A

---

### DefaultLanguage 설정 추가

**작업 일자**: 2026-02-12

**수행한 작업 요약**
- .csproj에 `<DefaultLanguage>en-US</DefaultLanguage>` 추가
- 리소스 파일이 없는 언어에서 확실하게 en-US로 fallback되도록 보장
- Package.appxmanifest의 `x-generate`는 유지 (지원 언어 자동 감지)

**변경된 파일**
- `AppGroup.csproj` - DefaultLanguage 속성 추가

**검증 결과**
- 빌드: 성공

---

### 정보(About) 메뉴 분리

**작업 일자**: 2026-02-12

**수행한 작업 요약**
- 설정 화면의 About Section 및 Open Source Licenses 섹션을 별도 "정보" 탭으로 분리
- NavigationView FooterMenuItems에 About 메뉴 아이템 추가 (E946 아이콘)
- NavView_SelectionChanged에 About 탭 표시/숨김 로직 추가
- 5개 언어 리소스에 NavAbout.Text 키 추가 (en-US: About, ko-KR: 정보, ja-JP: 情報, zh-CN: 关于, zh-TW: 關於)

**변경된 파일**
- `View/MainWindow.xaml` - AboutContent Grid 추가, Settings에서 About/License 섹션 제거, FooterMenuItems에 About 추가
- `View/MainWindow.xaml.cs` - NavView_SelectionChanged에 About 탭 핸들링 추가
- `Strings/en-US/Resources.resw` - NavAbout.Text 추가
- `Strings/ko-KR/Resources.resw` - NavAbout.Text 추가
- `Strings/ja-JP/Resources.resw` - NavAbout.Text 추가
- `Strings/zh-CN/Resources.resw` - NavAbout.Text 추가
- `Strings/zh-TW/Resources.resw` - NavAbout.Text 추가

**검증 결과**
- 빌드: 성공

**이전 작업 누락 보완**
- README.md 갱신 누락 → MainWindow 네비게이션 구조 테이블 추가로 보완
- Plan 승인 미획득 → 동일 실수 방지를 위해 메모리 등록

---

### 테마 변경 기능 추가

**작업 일자**: 2026-02-12

**수행한 작업 요약**
- 설정 화면 Language 아래에 테마 변경 ComboBox 추가 (시스템 기본값/다크/라이트)
- AppSettings에 Theme 속성 추가, settings.json에 영속 저장
- SettingsDialogViewModel에 SelectedTheme 속성 추가, Load/Save 반영
- 테마 변경 시 현재 윈도우에 즉시 적용 (FrameworkElement.RequestedTheme)
- 모든 윈도우(MainWindow, PopupWindow, EditGroupWindow, StartMenuPopupWindow, FolderContentsPopupWindow) 생성 시 저장된 테마 로드
- 5개 언어 리소스에 테마 관련 문자열 추가

**변경된 파일**
- `SettingsHelper.cs` - AppSettings.Theme 속성, ApplyThemeOverride(), GetSavedTheme() 추가
- `ViewModels/SettingsDialogViewModel.cs` - SelectedTheme 속성, Load/Save 반영
- `View/MainWindow.xaml` - Theme Section ComboBox UI 추가
- `View/MainWindow.xaml.cs` - InitializeThemeComboBox, SettingsThemeComboBox_SelectionChanged, ApplyThemeToWindow 추가, 생성자에 테마 적용
- `View/PopupWindow.xaml.cs` - 생성자에 테마 적용
- `View/EditGroupWindow.xaml.cs` - 생성자에 테마 적용
- `View/StartMenuPopupWindow.xaml.cs` - 생성자에 테마 적용
- `View/FolderContentsPopupWindow.xaml.cs` - 생성자에 테마 적용
- `Strings/en-US/Resources.resw` - ThemeSetting, ThemeSettingDescription, ThemeSystemDefault, ThemeDark, ThemeLight 추가
- `Strings/ko-KR/Resources.resw` - 동일 키 한국어 번역
- `Strings/ja-JP/Resources.resw` - 동일 키 일본어 번역
- `Strings/zh-CN/Resources.resw` - 동일 키 중국어 간체 번역
- `Strings/zh-TW/Resources.resw` - 동일 키 중국어 번체 번역

**검증 결과**
- 빌드: 성공

---

### 팝업 윈도우 테마 배경 미반영 수정

**작업 일자**: 2026-02-12

**수행한 작업 요약**
- StartMenuPopupWindow, FolderContentsPopupWindow의 UpdateMainGridBackground에서 앱 자체 테마(RequestedTheme)를 우선 참조하도록 수정
- 이전에는 UISettings.GetColorValue(UIColorType.Foreground)로 OS 시스템 테마만 감지하여, 앱 내 테마 변경 시 팝업 배경이 반영되지 않았음
- 팝업 표시(ShowPopup/ShowAt) 시 저장된 테마를 재적용하여 설정 변경 후 즉시 반영되도록 수정

**변경된 파일**
- `View/StartMenuPopupWindow.xaml.cs` - UpdateMainGridBackground 수정, ShowPopup에 테마 재적용 추가
- `View/FolderContentsPopupWindow.xaml.cs` - UpdateMainGridBackground 수정, ShowAt에 테마 재적용 추가
- `View/PopupWindow.xaml.cs` - UpdateMainGridBackground 수정, 앱 테마 우선 적용 (Accent Color 활성/비활성 모두)

**검증 결과**
- 빌드: 성공

---

### ContentDialog 테마 미반영 수정

**작업 일자**: 2026-02-12

**수행한 작업 요약**
- WinUI 3에서 코드로 생성한 ContentDialog는 부모 윈도우의 RequestedTheme을 자동 상속하지 않는 문제 수정
- StartMenuSettingsDialog 생성자에 저장된 테마 적용
- MainWindow의 인라인 ContentDialog 3곳에 RequestedTheme 명시 설정
- EditGroupWindow의 코드 생성 ContentDialog 5곳에 RequestedTheme 명시 설정
- EditGroupWindow의 XAML 정의 ContentDialog 5곳(EditItemDialog, CustomDialog, CustomizeDialog, FolderWebDialog, AllAppsDialog)에 ShowAsync 전 RequestedTheme 적용
- PopupWindow의 UpdateMainGridBackground에서 Accent Color 비활성 시 테마 적용 조건 수정 (빈 문자열 시에도 Default 적용)
- MainWindow, EditGroupWindow에 GetCurrentTheme() 헬퍼 메서드 추가

**변경된 파일**
- `View/StartMenuSettingsDialog.xaml.cs` - 생성자에 테마 적용
- `View/MainWindow.xaml.cs` - GetCurrentTheme() 추가, 인라인 ContentDialog 3곳에 RequestedTheme 적용
- `View/EditGroupWindow.xaml.cs` - GetCurrentTheme() 추가, 코드 생성 ContentDialog 5곳 + XAML 정의 ContentDialog 5곳에 RequestedTheme 적용
- `View/EditGroupWindow.AllApps.cs` - AllAppsDialog ShowAsync 전 테마 적용
- `View/PopupWindow.xaml.cs` - Accent Color 비활성 시 테마 적용 조건 수정

**검증 결과**
- 빌드: 성공

---

## 2026-02-10

### 하위 폴더 팝업 계층 탐색 기능 추가

**작업 일자**: 2026-02-10

**수행한 작업 요약**
- StartMenuPopupWindow 및 FolderContentsPopupWindow에 계층적 하위 폴더 탐색 기능 추가
- SubfolderDepth 설정 추가 (기본값 2, 범위 1~5)
- depth=1: 트레이 폴더 목록만 표시
- depth=2: 트레이 폴더 → 하위 폴더/파일 팝업
- depth=3~5: 더 깊은 하위 폴더까지 탐색
- 파일 항목 호버 시 하위 폴더 팝업 자동 닫기 기능 추가

**변경된 파일**
- `SettingsHelper.cs` - `AppSettings.SubfolderDepth` 기본값 1 → 2
- `View/FolderContentsPopupWindow.xaml.cs` - 깊이 추적 필드, `SetDepth()` 메서드, 하위 폴더 호버 타이머, 자식 팝업 관리, 재귀적 숨김, 파일 버튼에 `FileButton_PointerEntered` 핸들러 추가
- `View/StartMenuPopupWindow.xaml.cs` - `_subfolderDepth` 필드, 설정 로드, depth 전달, 조건부 호버 활성화
- `View/StartMenuSettingsDialog.xaml` - SubfolderDepthComboBox (이미 존재)
- `View/StartMenuSettingsDialog.xaml.cs` - SubfolderDepth 로드/저장 로직 (이미 존재)
- `Strings/ko-KR/Resources.resw` - SubfolderDepth, SubfolderDepthDescription 추가
- `Strings/en-US/Resources.resw` - SubfolderDepth, SubfolderDepthDescription 추가

**동작 방식**
1. **깊이 설정**: StartMenuSettingsDialog에서 1~5 선택
2. **StartMenuPopupWindow**: 설정 로드 후 FolderContentsPopupWindow에 `SetDepth(2, maxDepth)` 호출
3. **FolderContentsPopupWindow**: 
   - `_currentDepth < _maxDepth`일 때만 폴더 버튼에 호버 핸들러 등록
   - 호버 200ms 후 자식 FolderContentsPopupWindow 생성하여 왼쪽에 표시
   - 자식 팝업은 `SetDepth(currentDepth+1, maxDepth)` 호출
   - 파일 항목 호버 시 `HideChildPopup()` 호출하여 하위 팝업 닫기
4. **이벤트 전파**: 자식 팝업의 `FileExecuted` 이벤트를 상위로 전파하여 모든 팝업 닫기
5. **재귀적 정리**: `HideAllPopups()`로 모든 하위 팝업 재귀적 숨김, Dispose 체인 처리

**검증 결과**
- 빌드: 성공 (오류 0개)
- README.md: 갱신 완료

**제한 사항**
- 하위 팝업이 화면 밖으로 나가는 경우 왼쪽이 아닌 오른쪽에 표시됨
- 팝업이 많이 열린 경우 화면 공간 부족 가능

---

### 시작 탭 중복 폴더 등록 방지 메시지 추가

**작업 일자**: 2026-02-10

**수행한 작업 요약**
- 시작 탭에 이미 등록된 폴더를 드래그앤드롭 또는 다이얼로그로 추가하려 할 때 중복 메시지를 표시하도록 기능 추가
- 폴더 경로를 기준으로 대소문자 무시 비교하여 중복 판별
- 드래그앤드롭: 중복 폴더는 ContentDialog로 표시, 중복이 아닌 폴더만 추가
- 다이얼로그 추가 모드: EditStartMenuDialog 내부에 TextBlock(`FolderDuplicateMessage`)으로 인라인 메시지 표시 (ContentDialog 중첩 불가 문제 해결)

**변경된 파일**
- `View/MainWindow.xaml` - `FolderDuplicateMessage` TextBlock 추가
- `View/MainWindow.xaml.cs` - `StartMenuGrid_Drop`에 중복 검사 및 ContentDialog 표시, `SaveFolderEdit_Click`에 인라인 메시지 표시, 다이얼로그 열기 시 메시지 초기화
- `Strings/en-US/Resources.resw` - `FolderAlreadyExists` 리소스 문자열 추가
- `Strings/ko-KR/Resources.resw` - `FolderAlreadyExists` 리소스 문자열 추가

**검증 결과**
- 빌드: 성공 (오류 0개)
- 포맷팅: `dotnet format` 통과

---

### 시작 탭 목록 드래그 순서 변경 기능 추가

**작업 일자**: 2026-02-10

**수행한 작업 요약**
- 시작 탭(StartMenu)의 폴더 목록에 드래그로 순서를 변경할 수 있는 기능 추가
- 기존 Taskbar 탭의 드래그 순서 변경과 동일한 패턴(ListView `CanDragItems`/`CanReorderItems`/`DragItemsStarting`/`DragItemsCompleted`) 적용
- 변경된 순서를 JSON 파일에 영속 저장하고, 로드 시 JSON 키 순서를 유지하도록 정렬 제거

**변경된 파일**
- `View/MainWindow.xaml` - StartMenuListView 드래그 속성 활성화 (`CanDragItems`, `AllowDrop`, `CanReorderItems`, 이벤트 바인딩)
- `View/MainWindow.xaml.cs` - `_isStartMenuReordering` 필드, `StartMenuListView_DragItemsStarting`/`StartMenuListView_DragItemsCompleted` 핸들러, `UpdateStartMenuJsonWithNewOrderAsync` 메서드 추가, `StartMenuGrid_DragOver`에 내부 재정렬 시 외부 드롭 차단 로직 추가
- `JsonConfigHelper.cs` - `LoadStartMenuFoldersAsync`에서 `.OrderBy(f => f.FolderId)` 제거하여 JSON 키 순서 유지

**검증 결과**
- 빌드: 성공 (오류 0개)
- 포맷팅: `dotnet format` 통과

---

## 2026-02-08

### 파일 탐색기(shell:AppsFolder\Microsoft.Windows.Explorer) 실행 시 기존 탐색기 종료 버그 수정

**작업 일자**: 2026-02-08

**수행한 작업 요약**
- `shell:AppsFolder\Microsoft.Windows.Explorer`를 AppGroup에 등록하여 실행하면 기존 파일 탐색기 창이 모두 닫히는 버그 수정
- 원인: `Path.GetFileName`이 `Microsoft.Windows.Explorer`를 반환하여 기존 `explorer.exe` 특수 처리 분기를 타지 않음
- 결과적으로 `cmd.exe /c start`로 실행되어 Explorer 셸 프로세스가 재시작됨

**변경된 파일**
- `View/PopupWindow.xaml.cs` - `TryLaunchApp`, `TryRunAsAdmin`
- `JsonConfigHelper.cs` - `LaunchAll`

**변경 내용**
1. **`TryLaunchApp`**: explorer.exe 감지 조건에 `shell:AppsFolder\Microsoft.Windows.Explorer` 경로 비교 추가, `FileName`을 `"explorer.exe"`로 고정
2. **`TryRunAsAdmin`**: `shell:AppsFolder\Microsoft.Windows.Explorer`일 때 `explorer.exe`로 경로 정규화하는 로직 추가
3. **`LaunchAll`**: 병렬 실행 시 동일한 경로 정규화 로직 추가

**검증 결과**
- 빌드: 성공 (오류 0개)
- 포맷팅: `dotnet format` 통과

---

### 팝업 윈도우 숨김 실패 버그 수정

**작업 일자**: 2026-02-08

**수행한 작업 요약**
- StartMenuPopupWindow, FolderContentsPopupWindow 팝업이 목록 항목 클릭 후에도 사라지지 않는 버그 수정
- 원인: `_hoverTimer`(DispatcherTimer)가 팝업 숨김 시 중지되지 않아 200ms마다 `ShowAt()`으로 FolderContentsPopupWindow를 반복 표시

**변경된 파일**
- `View/StartMenuPopupWindow.xaml.cs`
- `View/FolderContentsPopupWindow.xaml.cs`

**변경 내용**
1. **`HoverTimer_Tick`**: `_hoverTimer?.Stop()` 추가 (one-shot 동작으로 변경), 잘못된 주석 수정
2. **`StopHoverTimer()` 헬퍼 메서드 추가**: 타이머 중지 + `_currentHoveredButton` null 처리
3. **팝업 숨기는 3개 경로에 `StopHoverTimer()` 호출 추가**:
   - `Window_Activated` Deactivated 분기
   - `FolderButton_Click`
   - `FolderContentsPopup_FileExecuted`
4. **FolderContentsPopupWindow에 `Window_Activated` 이벤트 핸들러 추가**: 포커스 잃으면 자동 숨김
5. **FolderContentsPopupWindow `Dispose`에 이벤트 해제 추가**: `this.Activated -= Window_Activated`

**검증 결과**
- 빌드: 성공 (오류 0개)
- 포맷팅: `dotnet format` 통과

---

## 2026-02-07

### FolderContentsPopupWindow 파일 아이콘 로직 단순화

**작업 일자**: 2026-02-07

**수행한 작업 요약**
- FolderContentsPopupWindow에서 파일 아이콘 로드 시 확장자별 fallback 아이콘 로직을 제거하고, 모든 파일에 대해 기본 아이콘(`file_4.png`)으로 초기화하도록 단순화

**변경된 파일**
- `View/FolderContentsPopupWindow.xaml.cs`

**변경 내용**
1. **`LoadFileIcon` 메서드**: 확장자 확인(`Path.GetExtension`) 및 `GetIconPathForExtension` 호출 제거, `FallbackDefaultIcon`으로 직접 초기화
2. **`LoadFileIconAsync` 메서드**: 사용하지 않는 `fallbackIconPath` 파라미터 제거
3. **삭제된 코드**:
   - `GetIconPathForExtension` 메서드 전체 (확장자별 아이콘 경로 반환)
   - `ExtensionIconMap` Dictionary (42개 확장자-아이콘 매핑)
   - `ArchiveExtensions`, `DocumentExtensions`, `ImageExtensions`, `VideoExtensions`, `AudioExtensions` HashSet
   - `FallbackArchiveIcon`, `FallbackDocumentIcon`, `FallbackImageIcon`, `FallbackVideoIcon`, `FallbackAudioIcon` 상수
4. **유지된 코드**: `FallbackDefaultIcon` 상수 (기본 파일 아이콘으로 계속 사용)

**검증 결과**
- 빌드: 성공 (오류 0개)
- 포맷팅: `dotnet format` 통과

**제한 사항**
- 아이콘 추출 성공 전까지 모든 파일이 동일한 기본 아이콘으로 표시됨 (기존에는 확장자별 아이콘이 표시되었음)

---

### 아이콘 추출 시 불필요한 크롭/리사이즈 제거

**작업 일자**: 2026-02-07

**수행한 작업 요약**
- EditGroupWindow에서 설치된 앱 목록의 아이콘이 일부 작게 표시되는 문제 수정
- 원인: `CropToActualContent`가 32x32 아이콘의 투명/배경 영역을 잘라내어 20x20 등으로 축소 후, 48x48로 업스케일하여 저장 → UI에서 24x24로 표시 시 실제 내용이 작게 보임
- `CropToActualContent` 호출 제거 (5곳) + 48x48 강제 리사이즈 로직 제거

**변경된 파일**
- `IconHelper.Extraction.cs`

**변경 내용**
1. **`ExtractIconWithoutArrow` 메서드** (3곳)
   - Method 3 (ExtractIconEx): `CropToActualContent(rawBitmap)` → `new Bitmap(rawBitmap)`
   - Method 4 (SHGetFileInfo): `CropToActualContent(rawBitmap)` → `new Bitmap(rawBitmap)`
   - Method 5 (ExtractAssociatedIcon): `CropToActualContent(rawBitmap)` → `new Bitmap(rawBitmap)`

2. **`ExtractSpecificIcon` 메서드** (2곳)
   - Method 3 (ExtractIconEx): `CropToActualContent(rawBitmap)` → `new Bitmap(rawBitmap)`
   - Method 4 (SHGetFileInfo): `CropToActualContent(rawBitmap)` → `new Bitmap(rawBitmap)`

3. **`ExtractIconAndSaveAsync` 메서드**
   - 48x48 강제 리사이즈 블록 전체 삭제 (`resizedBitmap` 변수 및 Graphics 리사이즈 로직)
   - `resizedBitmap` 참조를 모두 `iconBitmap`으로 변경
   - Dispose 후 접근 방지를 위해 `savedWidth`/`savedHeight` 변수 사용
   - `size` 파라미터는 유지 (Windows API 요청 크기 힌트로 사용됨)

**검증 결과**
- 빌드: 성공 (오류 0개)
- 포맷팅: `dotnet format` 통과

**제한 사항**
- `CropToActualContent` 메서드 자체는 삭제하지 않음 (다른 곳에서 사용될 수 있음)
- 기존에 캐시된 아이콘 파일은 파일명 해시가 변경되므로 자동으로 새로 생성됨

---

## 2026-02-06

### 코드 리뷰 심각한 문제 21건 수정

**작업 일자**: 2026-02-06

**수정된 이슈**

#### Step 1: Bitmap/GDI+ 리소스 수정
- **IconHelper.UwpExtractor.cs:411** - `TryExtractIconFromShellPath`에서 `using` 제거하여 Disposed 객체 반환 방지
- **IconHelper.Extraction.cs:162** - `using (var rawBitmap = icon.ToBitmap())` → `new Bitmap(icon.ToBitmap())`로 변경
- **IconHelper.Extraction.cs:268** - `icon.ToBitmap().Save(...)` → `using (var tempBitmap)` 블록으로 GDI+ 리소스 해제
- **IconHelper.Extraction.cs:392** - `icon.ToBitmap()` 반환값을 변수로 받아 `CreateBitmapImageFromBitmap` 내부에서 dispose
- **IconHelper.Extraction.cs:1179** - `CreateBitmapImageFromBitmap`에 `finally { bitmap.Dispose(); }` 추가, 호출 측 `using` 제거
- **IconHelper.UwpExtractor.cs:517~540** - `GetPixel`/`SetPixel` → `LockBits` + `Marshal.Copy` 기반 고속 알파 채널 처리

#### Step 2: COM 객체 해제 (7곳)
- **BackupHelper.cs:589** - `SafeCreateShortcut`에 `try/finally` + `Marshal.ReleaseComObject()` 추가
- **JsonConfigHelper.cs:383~423** - `UpdateShortcutIcon`, `UpdateShortcutTarget` COM 해제 추가
- **TaskbarManager.cs:13~42** - `IsShortcutPinnedToTaskbar` 루프 내 shortcut 및 wshShell COM 해제 추가
- **IconHelper.GridIcon.cs:~200** - `CreateGridIconAsync` 루프 내 shell, shortcut COM 해제 추가
- **IconHelper.Extraction.cs:312** - `ExtractLnkIconWithoutArrowAsync` COM 즉시 해제 패턴 적용
- **EditGroupWindow.AllApps.cs:199~287** - `GetAppsFromShellFolder` shell, folder, item COM 해제 추가
- **EditGroupWindow.AllApps.cs:323~445** - `GetAppIconFromShellAsync`, `GetShortcutTarget` COM 해제 추가

#### Step 3: 이벤트 핸들러/콜백 해제 (3곳)
- **ThemeHelper.cs** - 익명 람다 → 명명된 핸들러 + 중복 등록 방지 + `window.Closed`에서 해제
- **FolderContentsPopupWindow.xaml.cs** - `Dispose`에 `UnregisterButtonEvents` 추가 (Click, PointerEntered, PointerExited 해제)
- **StartMenuPopupWindow.xaml.cs:305** - `Dispose`에 `this.Activated -= Window_Activated` 추가

#### Step 4: 논리적 버그 수정 (3곳)
- **WindowHelper.cs:86** - `IsAlwaysOnTop` getter: `presenter.IsMaximizable` → `presenter.IsAlwaysOnTop` (복붙 오류 수정)
- **Program.cs:60~68** - 기존 인스턴스 발견 시 `return;` 추가하여 새 인스턴스 생성 방지
- **SystemTrayManager.cs:380~383** - `Cleanup()`에 `onTrayClickCallback = null`, `onHidePopupCallback = null` 추가

#### Step 5: 리소스 관리 (2곳)
- **WindowHelper.cs** - `IDisposable` 구현, `Dispose()`에서 `RemoveWindowSubclass` 호출
- **NativeMethods.cs:390~410** - `SendString` cdsPtr를 `finally`에서 해제하도록 변경

#### Step 6: 모델 분리
- **PathData, GroupData 클래스** - `PopupWindow.xaml.cs`에서 `Models/PathData.cs`, `Models/GroupData.cs`로 분리

**변경된 파일** (생략 - 상세 참조)

**검증 결과**
- 빌드: 성공 (오류 0개, 경고 773개 - 기존 nullable 관련 경고)

**참고: 동일 실수 방지**
- `using` 블록 안에서 객체를 반환하면 Disposed 객체가 반환됨 - 반환용 객체는 `using` 밖에서 생성
- COM 객체(WScript.Shell, Shortcut 등)는 반드시 `try/finally` + `Marshal.ReleaseComObject()` 패턴 사용
- 이벤트 핸들러는 등록과 해제가 반드시 쌍을 이루어야 함 - 익명 람다보다 명명된 메서드 선호
- `GetPixel`/`SetPixel`은 성능이 매우 나쁨 - 픽셀 조작은 `LockBits` + `Marshal.Copy` 사용
- 속성 getter에서 복붙 오류 주의
- 네이티브 리소스(Subclass 등) 사용 시 `IDisposable` 구현 필수

---

### StartMenuPopupWindow 2열 이상 그리드 레이아웃 높이/너비 계산 수정

**작업 일자**: 2026-02-06

**문제점**
- 2열 이상 그리드 레이아웃에서 윈도우 높이가 부족하여 스크롤이 나타남

**원인 분석**
- `GRID_LAYOUT_ROW_HEIGHT(100)` 상수가 실제 행 높이(`GRID_LAYOUT_BUTTON_HEIGHT(100) + ITEM_MARGIN(4)*2 = 108`)보다 작음
- 버튼 크기 변경 시 `GRID_LAYOUT_ROW_HEIGHT`/`GRID_LAYOUT_COLUMN_WIDTH` 상수도 함께 변경해야 하는 동기화 문제

**수정 내용**
- 행 높이: `GRID_LAYOUT_ROW_HEIGHT` 상수 대신 `GRID_LAYOUT_BUTTON_HEIGHT + ITEM_MARGIN * 2`로 동적 계산
- 열 너비: `GRID_LAYOUT_COLUMN_WIDTH` 상수 대신 `GRID_LAYOUT_BUTTON_WIDTH + ITEM_MARGIN * 2`로 동적 계산

**변경된 파일**
- `View/StartMenuPopupWindow.xaml.cs`

**검증 결과**
- 빌드: 성공 (오류 0개)

---

(나머지 2026-02-06 작업들 생략 - 파일 너무 길어질 경우 분리)

---

## 2026-02-05

### 코드 파일 분리 작업 완료

**작업 일자**: 2026-02-05

**완료된 분리**

#### 1. NativeMethods.cs (1333줄 → 466줄)
**분리된 파일:**
- `NativeMethods.cs` (466줄)
- `NativeMethods.WindowPosition.cs` (623줄)
- `NativeMethods.ShellIcon.cs` (499줄)

#### 2. IconHelper.cs (1374줄 → 18줄)
**분리된 파일:**
- `IconHelper.cs` (18줄)
- `IconHelper.UwpExtractor.cs` (659줄)
- `IconHelper.GridIcon.cs` (319줄)
- `IconHelper.Extraction.cs` (998줄)
- `IconHelper.Bitmap.cs` (400줄)

#### 3. EditGroupWindow.xaml.cs (1843줄 → 862줄)
**분리된 파일:**
- `EditGroupWindow.xaml.cs` (862줄)
- `EditGroupWindow.AllApps.cs` (500줄)
- `EditGroupWindow.FolderWeb.cs` (481줄)

**검증 결과**
- 빌드: 성공 (오류 0개)
- 경고: 645개 (모두 nullable 관련)
- 코드 가독성 향상
- 유지보수성 개선

---

(2026-02-05의 나머지 작업들은 간략하게 요약만 작성)

### 기타 2026-02-05 작업
- FolderContentsPopupWindow, StartMenuPopupWindow 하드코딩된 값 상수화
- MainWindow 폴더 드래그앤드롭 저장 버그 수정
- StartMenuPopupWindow 히트 테스트 문제 수정
- StartMenuPopupWindow 및 FolderContentsPopupWindow 팝업 크기 변경 최종 수정
- 설정 화면을 NavigationView로 통합
- 시작 메뉴 설정 ContentDialog 추가

---

## 2026-02-04

### 주요 작업 (간략 요약)
- TabView 구현 및 시작 메뉴 기능 추가
- StartMenuDropGrid 드롭 영역 크기 수정
- 시작 메뉴 탭 드래그앤드롭 버그 수정
- 왼쪽 메뉴바 UI 수정
- StartMenuSettingsDialog, StartMenuPopupWindow 빌드 오류 수정

**검증 결과**: 모두 빌드 성공

---

## 2026-02-03

### 미사용 코드 삭제 및 빌드 경고 수정

**작업 일자**: 2026-02-03

**주요 작업**
- 미사용 파일 삭제: `SupportDialogHelper.cs`
- 미사용 메서드 삭제: IconHelper.cs, EditGroupHelper.cs
- 빌드 경고 수정: CS0626, CS0169, CS0414, CS0649

**검증 결과**
- 빌드: 성공
- 경고: 656개 → 616개 (40개 감소)
