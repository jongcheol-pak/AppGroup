# 2026년 1월 작업 로그

## 2026-01-31

### 코드 품질 및 보안 개선 (Critical 이슈 수정)

**작업 일자**: 2026-01-31

**수정된 이슈**

1. **데드락 위험 수정** (App.xaml.cs)
   - 문제: 생성자에서 `Task.Run().Wait()` 사용으로 UI 스레드 블로킹 및 데드락 위험
   - 수정: `_pendingLaunchAllGroupName` 필드 추가, OnLaunched에서 비동기 처리

2. **이벤트 핸들러 누수 수정** (SettingsDialog.xaml.cs)
   - 문제: Toggle 이벤트 핸들러가 Unloaded 시 해제되지 않아 메모리 누수
   - 수정: `SettingsDialog_Unloaded` 메서드 추가

3. **경로 인젝션 취약점 수정** (MainWindow.xaml.cs)
   - 문제: `draggedItem.GroupName`이 파일 경로에 직접 사용되어 경로 트래버설 공격 가능
   - 수정: `IsValidGroupName()` 검증 메서드 추가

**변경된 파일**
- `App.xaml.cs`
- `View/SettingsDialog.xaml.cs`
- `View/MainWindow.xaml.cs`

**검증 결과**
- 빌드: 성공 (오류 0개)

---

### PopupWindow 아이콘 이미지 품질 개선

**작업 일자**: 2026-01-31

**문제점**: BitmapImage 로드 시 DecodePixelWidth/Height 미설정으로 스케일링 품질 저하

**수정 내용**
- `IconCache.cs`의 `LoadImageFromPathAsync` 메서드 수정
- `decodeSize` 파라미터 추가 (기본값 48px)
- `DecodePixelWidth`/`DecodePixelHeight` 설정
- `DecodePixelType.Logical` 설정으로 DPI 자동 스케일링

**변경된 파일**: `IconCache.cs`

**검증 결과**: 빌드 성공

---

### PopupWindow에서 실행한 앱이 AppGroup 종료 시 함께 종료되는 문제 수정

**작업 일자**: 2026-01-31

**문제점**: MSIX 패키지 앱은 Windows가 Job Object로 모든 자식 프로세스를 관리하기 때문에 부모 프로세스 종료 시 함께 종료됨

**수정 내용**
- `TryLaunchApp`: `cmd.exe /c start`를 통해 실행하여 Job Object에서 분리
- `TryRunAsAdmin`: `powershell.exe Start-Process -Verb RunAs`를 통해 관리자 권한 실행

**변경된 파일**: `View/PopupWindow.xaml.cs`

**검증 결과**: 빌드 성공

---

### ICO 변환 시 이미지 비율 유지 수정

**작업 일자**: 2026-01-31

**문제점**: 정사각형이 아닌 이미지가 강제로 정사각형으로 늘어나서 찌그러짐

**수정 내용**
- `ConvertToIco` 메서드 수정
- 원본 이미지 비율 계산하여 유지
- 정사각형 캔버스에 중앙 배치

**변경된 파일**: `IconHelper.cs`

**검증 결과**: 빌드 성공

---

### 그룹 편집 시 아이콘 파일 없음 오류 수정

**작업 일자**: 2026-01-31

**문제점**: 아이콘 파일이 존재하지 않으면 `FileNotFoundException` 발생

**수정 내용**
- `LoadGroupAsync` 메서드 수정
- 아이콘 로드 전 `File.Exists` 확인 추가
- 파일이 없거나 로드 실패 시 기본 상태로 유지

**변경된 파일**: `View/EditGroupWindow.xaml.cs`

**검증 결과**: 빌드 성공

---

### 저장 시 아이콘 파일 처리 오류 수정

**작업 일자**: 2026-01-31

**문제점 1**: ICO 변환 시 파일 잠금 오류
**문제점 2**: 파일 삭제 후 사용 시도

**수정 내용**
1. `IconHelper.cs`의 `ConvertToIco` - `File.ReadAllBytesAsync` + `Image.FromStream` 사용
2. `EditGroupWindow.xaml.cs`의 `CreateShortcut_Click` - 기존 파일 삭제 전에 메모리로 읽어둠

**변경된 파일**
- `IconHelper.cs`
- `View/EditGroupWindow.xaml.cs`

**검증 결과**: 빌드 성공

---

### 앱 추가 시 IconPath 누락 버그 수정

**작업 일자**: 2026-01-31

**문제점**: 새로 추가된 앱의 `IconPath`가 설정되지 않아 JSON에 빈 문자열로 저장됨

**수정 내용**
- `EditGroupWindow.xaml.cs`의 모든 `ExeFiles.Add` 호출에 `IconPath = icon` 추가
  - 파일 드래그&드롭 추가
  - 파일 선택 추가
  - 설치된 앱 목록에서 추가

**변경된 파일**: `View/EditGroupWindow.xaml.cs`

**검증 결과**: 빌드 성공

---

### 그룹 편집 시 임시 아이콘 파일 접근 오류 수정

**작업 일자**: 2026-01-31

**문제점**: temp 폴더에 복사 시 `System.UnauthorizedAccessException` 발생

**최종 수정 내용**
1. **temp 폴더 복사 코드 전체 제거**
2. 원본 파일 경로를 직접 사용
3. tempIcon 삭제 시 temp 폴더 경로인지 확인

**변경된 파일**: `View/EditGroupWindow.xaml.cs`

**검증 결과**: 빌드 성공

---

### 아이콘 크기 문제 수정 (SHGetImageList 적용)

**작업 일자**: 2026-01-31

**문제점**: 설치된 앱 목록에서 일부 앱의 아이콘이 32x32 크기로 작게 표시됨

**수정 내용**
1. **NativeMethods.cs 수정**
   - `IImageList` COM 인터페이스 추가
   - `SHGetImageList` P/Invoke 추가

2. **IconHelper.cs 수정**
   - `TryExtractIconViaSHGetImageList` 메서드 추가
   - `ExtractIconWithoutArrow`, `ExtractSpecificIcon` 개선
   - `CropToActualContent` 메서드 추가

**아이콘 추출 우선순위**
1. `IShellItemImageFactory` (256/128/64/48/32)
2. `SHGetImageList` (256x256 또는 48x48) - 신규
3. `ExtractIconEx` (32x32)
4. `SHGetFileInfo` (32x32)
5. `ExtractAssociatedIcon` (32x32)

**변경된 파일**
- `NativeMethods.cs`
- `IconHelper.cs`

**검증 결과**: 빌드 성공 (경고 624개 - 기존)

---

### 코드 품질 및 보안 개선

**작업 일자**: 2026-01-31

**수행한 작업**
1. 메모리 누수 수정 (MainWindow.xaml.cs)
2. 비동기 작업 미완료 수정 (App.xaml.cs)
3. UI 스레드 블로킹 제거 (App.xaml.cs)
4. 중복 코드 제거 - `AppPaths.cs` 신규 생성
5. 경로 보안 검증 추가 (EditGroupWindow.xaml.cs)
6. 주석 처리된 코드 정리

**변경된 파일**
- `AppPaths.cs` (신규)
- `NativeMethods.cs`
- `App.xaml.cs`
- `View/MainWindow.xaml.cs`
- `View/EditGroupWindow.xaml.cs`
- `View/PopupWindow.xaml.cs`

**검증 결과**: 빌드 성공 (오류 0개, 경고 3개)

---

### Windows 부팅 시 자동 실행 시 메인 윈도우 표시 버그 수정

**작업 일자**: 2026-01-31

**문제점**: Windows 부팅 시 StartupTask로 자동 실행되면 silent 모드로 동작해야 하는데 메인 윈도우도 함께 표시됨

**수정 내용**
- `App.xaml.cs`의 `CreateAllWindows()` 메서드에 메인 윈도우 숨기기 코드 추가

**변경된 파일**: `App.xaml.cs`

**검증 결과**: 빌드 성공

---

## 2026-01-30

### 아이콘 상하 반전 버그 수정

**작업 일자**: 2026-01-30

**문제점**: `IShellItemImageFactory.GetImage`에서 반환하는 HBITMAP이 이미 top-down 순서인데 뒤집기 수행하여 상하 반전됨

**최종 수정**: 뒤집기 로직 완전히 제거

**변경된 파일**
- `NativeMethods.cs`
- `IconHelper.cs`

**검증 결과**: 빌드 성공

---

### 백그라운드 동작 최적화 및 메모리 누수 수정

**작업 일자**: 2026-01-30

**수행한 작업**
1. MainWindow.xaml.cs: FileSystemWatcher 이벤트 핸들러 개선
2. PopupWindow.xaml.cs: COM 객체 해제, CancellationToken 추가
3. EditGroupWindow.xaml.cs: IDisposable 패턴 구현
4. IconCache.cs: 캐시 크기 제한 추가 (MAX_CACHE_SIZE = 500)

**변경된 파일**
- `View/MainWindow.xaml.cs`
- `View/PopupWindow.xaml.cs`
- `View/EditGroupWindow.xaml.cs`
- `IconCache.cs`

**검증 결과**: 빌드 성공

---

### StartupTask 상태 처리 개선

**작업 일자**: 2026-01-30

**문제점**: `DisabledByUser` (사용자가 Windows 설정에서 거부) 상태 미처리

**수행한 작업**
1. SettingsHelper.cs: `AddToStartupAsync()` 반환 타입을 `Task<StartupTaskState?>`로 변경
2. SettingsDialogViewModel.cs: 상태 표시 속성 추가
3. SettingsDialog.xaml: 차단 상태 메시지 UI 추가

**변경된 파일**
- `SettingsHelper.cs`
- `ViewModels/SettingsDialogViewModel.cs`
- `View/SettingsDialog.xaml`

**검증 결과**: 빌드 성공

---

### MSIX StartupTask 자동 실행 시 silent 모드 지원

**작업 일자**: 2026-01-30

**문제점**: MSIX StartupTask API는 명령줄 인자(`--silent`)를 직접 지원하지 않음

**수행한 작업**
- `IsStartedByStartupTask()` 메서드 추가
- `HasSilentFlag()` 메서드 수정

**변경된 파일**: `App.xaml.cs`

**검증 결과**: 빌드 성공

---

### Windows 시작 시 자동 실행 기능 개선

**작업 일자**: 2026-01-30

**문제점**: MSIX 패키지 앱에서 레지스트리 기반 시작 프로그램 등록이 제대로 작동하지 않음

**수행한 작업**
1. Package.appxmanifest: `uap5:StartupTask` 확장 추가
2. SettingsHelper.cs: StartupTask API 메서드 추가
3. SettingsDialogViewModel.cs: 비동기 호출 반영

**변경된 파일**
- `Package.appxmanifest`
- `SettingsHelper.cs`
- `ViewModels/SettingsDialogViewModel.cs`

**검증 결과**: 빌드 성공 (x64)

---

### 설치된 앱 목록 아이콘 표시 개선 (3차 수정)

**작업 일자**: 2026-01-30

**문제점**: UWP 앱의 바로가기 타겟이 `shell:AppsFolder\{aumid}` 형식인 경우 아이콘 추출 실패

**수행한 작업**
1. `ExtractIconAndSaveAsync`: `shell:AppsFolder` 경로 처리 추가
2. `ExtractUwpAppIconAsync`: Manifest 로고 검색 대폭 개선
3. `ExtractIconFromShellItem` 메서드 추가
4. `ExtractIconUsingSHGetFileInfo` 메서드 추가
5. NativeMethods.cs: Shell API 인터페이스 추가

**아이콘 추출 우선순위**
1. `ExtractUwpAppIconAsync`
2. `ExtractIconFromShellItem`
3. `ExtractWindowsAppIconAsync`
4. `ExtractIconEx`
5. `SHGetFileInfo`
6. `ExtractAssociatedIcon`

**변경된 파일**
- `IconHelper.cs`
- `NativeMethods.cs`
- `View/EditGroupWindow.xaml.cs`

**검증 결과**: 빌드 성공 (x64)

---

### MVVM 패턴 적용 (View 폴더 생성 및 파일 이동)

**작업 일자**: 2026-01-30

**수행한 작업**
- View 폴더 생성 및 XAML 파일 이동
- namespace를 `AppGroup`에서 `AppGroup.View`로 변경

**변경된 파일** (이동)
- MainWindow, EditGroupWindow, PopupWindow, SettingsDialog

**변경된 파일** (참조 수정)
- AppGroup.csproj, App.xaml.cs, EditGroupHelper.cs, BackupHelper.cs

**검증 결과**: 빌드 성공 (x64, 오류 0개, 경고 265개)

---

## 2026-01-29

### UI 한글화

**작업 일자**: 2026-01-29

**수행한 작업**: 모든 UI 텍스트를 영어에서 한글로 번역

**변경된 파일**
- MainWindow.xaml, EditGroupWindow.xaml, SettingsDialog.xaml
- MainWindow.xaml.cs, EditGroupWindow.xaml.cs, SettingsDialog.xaml.cs
- BackupHelper.cs, PopupWindow.xaml.cs

**검증 결과**: 빌드 성공 (x64, 오류 0개)

---

### 파일 인코딩 변환

**작업 일자**: 2026-01-29

**수행한 작업**: 프로젝트의 모든 소스 파일을 UTF-8 with BOM 인코딩으로 변환

**변경된 파일**: 28개 (.cs, .xaml, .md)

**검증 결과**: 빌드 성공 (x64)

---

### 설치된 앱 목록 기능 개선

**작업 일자**: 2026-01-29

**수행한 작업**
- `AllAppsButton_Click` 메서드의 앱 목록 수집 방식을 `shell:AppsFolder` 기반으로 변경
- Windows의 "설정 > 앱 > 설치된 앱"과 동일한 목록 표시

**추가된 메서드**
- `GetAppsFromShellFolder()`
- `TryGetExePathFromAumid()`
- `GetAppIconFromShellAsync()`
- `SanitizeFileName()`

**삭제된 메서드**
- `GetRegistryApps()`

**변경된 파일**: `EditGroupWindow.xaml.cs`

**검증 결과**: 빌드 성공 (x64)

---

## 2025년 작업 (날짜 불명확)

### 설치된 앱 목록 기능 추가

**추가된 기능**
- AllAppsButton: 설치된 Windows 앱 목록 표시
- 체크박스로 여러 앱 선택
- 검색 기능 지원

**추가된 클래스**: `InstalledAppModel`

**UI 컴포넌트**: AllAppsDialog, AllAppsListView, AppSearchTextBox 등

---

### 코드 정리

**제거된 기능**
- `SupportDialogHelper` 관련 코드 삭제
- GitHub 버튼, Coffee(Support) 버튼 삭제

**비활성화된 기능**
- `CheckForUpdatesOnStartupAsync()` 호출 주석 처리
